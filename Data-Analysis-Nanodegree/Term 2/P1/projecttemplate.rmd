Analysis of contributors to Prosper loan scores by Charles Dellinger
========================================================

> **Tip**: You will see quoted sections like this throughout the template to
help you construct your report. Make sure that you remove these notes before
you finish and submit your project!

> **Tip**: One of the requirements of this project is that your code follows
good formatting techniques, including limiting your lines to 80 characters or
less. If you're using RStudio, go into Preferences \> Code \> Display to set up
a margin line to help you keep track of this guideline!

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(rmarkdown)
library(ggplot2)
library(gridExtra)
```

```{r}
# this was needed for my RStudio install to find pandoc
# pandoc_location <- Sys.getenv("RSTUDIO_PANDOC")
# Sys.setenv(RSTUDIO_PANDOC=as.character(pandoc_location))
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
loanData <- read.csv('prosperLoanData.csv')
```

The data set is about personal loans made through [Prosper Marketplace](https://www.prosper.com).
Propser anonymously connects private users who want to lend and borrow money.
The marketplace allows users to apply and receive loans from $2,000 to $40,000.
During the application process, fairly standard information, like income,
occupation, assets, and credit score, is collected. The application information
with additionation data about the loan itself, including current state, is what
this data set contains. A full list of data collected about each loan is below:

<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
</style>

<div class="col2">
```{r echo=FALSE, Column_Names}
sort(names(loanData))
```
<div>

# Univariate Plots Section

> **Tip**: In this section, you should perform some preliminary exploration of
your dataset. Run some summaries of the data and create univariate plots to
understand the structure of the individual variables in your dataset. Don't
forget to add a comment after each plot or closely-related group of plots!
There should be multiple code chunks and text sections; the first one below is
just to help you get started.

```{r}

```

* IncomeRange
```{r echo=FALSE, IncomeRange_to_Ordered_Factor}
# The plot of IncomeRange was unordered, so changing the variable to an ordered
# factor is necessary to get the plot to display logically.

# check the structure and get current headings
# str(loanData$IncomeRange)
# levels(loanData$IncomeRange)

# change the headings to an ordered factor
loanData$IncomeRange = factor(loanData$IncomeRange,
                              levels= c("Not displayed",
                                        "Not employed",
                                        "$0",
                                        "$1-24,999",
                                        "$25,000-49,999",
                                        "$50,000-74,999",
                                        "$75,000-99,999",
                                        "$100,000+"))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Create_IncomeRange2}                          
# checkout summary of IncomeRange
summary(loanData$IncomeRange)

# create a new column that merges 'Not employed' and '$0',
# because unemployed people make $0 in theory
loanData$IncomeRange2 <- loanData$IncomeRange
loanData$IncomeRange2[loanData$IncomeRange2 == 'Not employed'] = '$0'
```

```{r echo=FALSE, message=FALSE, warning=FALSE, IncomeRange2_Histogram}
# graph income ranges in IncomeRange2
ggplot(aes(x = IncomeRange2), data = loanData) +
  geom_histogram(stat="count") + coord_flip()

# get rid of 'Not displayed' on the graph
# ggplot(aes(x = IncomeRange2),
#        data = subset(loanData, IncomeRange2 != 'Not displayed')) +
#   geom_histogram(stat="count") + coord_flip()
```

The histogram of IncomeRange shows that most of the borrowers make between 
$25,000 to $75,000.

* StatedMonthlyIncome

```{r echo=FALSE, StatedMonthlyIncome_Histogram}
summary(loanData$StatedMonthlyIncome)
ggplot(aes(x = StatedMonthlyIncome), data = loanData) +
  geom_histogram(binwidth = 12500) +
  scale_x_continuous(limits = c(0,175000)) + #, breaks = seq(0,180000,10000)) +
  scale_y_log10()
```
The stated monthly income histogram paints a slightly different picture than the
income range bins. The income range bins had more of a bell-curve type shape,
whereas the stated income curve looks skewed right.

Will the StatedMonthlyIncome look the same if it is sorted into buckets?

```{r echo=FALSE, StatedMonthlyIncome_Bucket_Histogram}

loanData$StatedMonthlyIncome.bucket <- cut(as.numeric(loanData$StatedMonthlyIncome),
                                           breaks=c(0,1,
                                                    25000,
                                                    50000,
                                                    75000,
                                                    100000,
                                                    1750003+1),
                                           right = FALSE)
table(loanData$StatedMonthlyIncome.bucket)
loanData$StatedMonthlyIncome.bucket <- 
  factor(loanData$StatedMonthlyIncome.bucket)
# loanData$StatedMonthlyIncome.bucket[loanData$StatedMonthlyIncome <= 100000] =
#   '100000+'
# loanData$StatedMonthlyIncome.bucket <-
#   factor(loanData$StatedMonthlyIncome.bucket,
#          )

ggplot(aes(x = StatedMonthlyIncome.bucket),
       data = subset(loanData,
                     !is.na(StatedMonthlyIncome.bucket))) +
  geom_histogram(stat="count") + coord_flip()
```

```{r check StatedMonthlyIncome.bucket}
# look at IncomeRange2 counts for comparison
# table(loanData$IncomeRange2)

# look at StatedMonthlyIncome.bucket counts
# table(loanData$StatedMonthlyIncome.bucket)

# check range with a most of the entries and another range
# length(loanData$StatedMonthlyIncome[loanData$StatedMonthlyIncome >= 1 &
#                                     loanData$StatedMonthlyIncome < 25000])
# length(loanData$StatedMonthlyIncome[loanData$StatedMonthlyIncome >= 25000 &
#                                     loanData$StatedMonthlyIncome < 50000])

# everything adds up, so unsure about the difference in ranges
```

The histogram of StatedMonthlyIncome buckets doesn't seem to align with the
income buckets outlined by IncomeRange.

* Occupation

```{r echo=FALSE, Occupation}
ggplot(aes(x = Occupation), data = loanData) +
  geom_histogram(stat="count") + coord_flip()
```

Occupation is going to be pretty useless for categorization as it is since there
are so many. Even if grouped, a category like healthcare workers would have 
different results for instance with a "Nurse's Aide" versus a "Doctor". Also,
the catch alls of "Other" and "Professional" are ambiguious and seem to 
dominate; the proportion of Occupation entries:

```{r echo=FALSE, Occupation_counts}
professions <- c(sum(loanData$Occupation == 'Professional'),
                 sum(loanData$Occupation == 'Other'),
                 sum(loanData$Occupation != 'Other' &
                       loanData$Occupation != 'Professional' &
                       !is.na(loanData$Occupation)))
professions <- professions/sum(professions)
names(professions) <- c('Professional', 'Other', 'Everything Else')
print(professions)
```

With almost 40% of Occupation entries unusable, the subgroup analysis probably
won't produce generalizable results.

* Debt-to-Income Ratio
```{r echo=FALSE, DebtToIncomeRatio_Histogram}
# summary(loanData$DebtToIncomeRatio)
ggplot(aes(x = DebtToIncomeRatio), data = loanData) +
  geom_histogram(breaks = seq(0,10,1)) +
  #scale_y_log10() +
  scale_x_continuous(breaks = seq(0,10,1))
```

Almost all the debt-to-income ratios are less than 1. People with more debt to
pay than their income would have an almost 100% chance of default


```{r echo=FALSE, DebtToIncomeRatio_breakpoint_count}
dtiRatio <- c(with(loanData,
                   sum(DebtToIncomeRatio[!is.na(DebtToIncomeRatio)] <= 1)),
              with(loanData,
                   sum(DebtToIncomeRatio[!is.na(DebtToIncomeRatio)] > 1)))
names(dtiRatio) <- c('<= 1', '> 1')
print(dtiRatio)
```

* Delinquencies in the Last 7 Years

```{r echo=FALSE, DelinquenciesLast7Years}
ggplot(aes(x = DelinquenciesLast7Years), data = loanData) +
  geom_histogram()# + scale_y_log10()
```

The users applying for loans had a fair number of instances where the payments
were late. This metric is a mixed bag for lenders as it would mean that the
borrower would accrue interest but also the borower has a higher risk of
default.

* Total Trades on the Prosper Platform

```{r echo=FALSE, TotalTrades }
ggplot(aes(x = TotalTrades), data = loanData) +
  geom_histogram()
```

In general, the number of trades is skewed to the right, but the curve between
0 and 50 shows that a lot of borrowers are repeat users.

* Term Length of Loans

```{r echo=FALSE, Length_of_Terms}
ggplot(aes(x = Term), data = loanData) +
  geom_histogram(binwidth = 1) + coord_flip()
# there looks to be three clear term lengths
# clear term demarkations can be confirmed by making a table
table(loanData$Term)
```

The data set contains only three loan lengths, which correspond to 1, 3, and 5
years.

* Home Ownership

```{r echo=FALSE, Home_Ownership}
ggplot(aes(x = IsBorrowerHomeowner), data = loanData) +
  geom_histogram(stat='count') + coord_flip()
```

Homeownership would show that a person has an asset, which would make the loan
more viable because the borrower can both make payments and has something to
borrow against if they need money to meet their liabilities.

This variable might be a good one to use to see split scores or behavior between
those that own a home or not.

* BankcardUtilization
This variable is strange: "The percentage of available revolving credit that is 
utilized at the time the credit profile was pulled." It seems like the amount of
available credit that the borrower is utilizing, or home much of the credit
card potential have they used.

```{r echo=FALSE, Bankcard_Utilization}
ggplot(aes(x = BankcardUtilization), data = loanData) +
  geom_histogram(binwidth = 0.05)
ggplot(aes(x = 1, y = BankcardUtilization), data = loanData) +
  geom_boxplot() +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  coord_flip() + scale_y_continuous(breaks = seq(0,6,0.25))
summary(loanData$BankcardUtilization)
```

The shape of the bank card utilization histogram shows a spike at 0% and then
an increasing trend as the percentage approaches 100%. The box plot show that
there are a fair number of people that have somehow overdrafted their bank cards
to a pretty high extent. The bank card percentage score would be an interesting
metric to test correlations to in the multivariate analysis.

* Credit Score Range

```{r echo=FALSE, Credit_Scores}
creditUpper <- ggplot(aes(x = CreditScoreRangeLower), data = loanData) +
  geom_histogram()
creditLower <- ggplot(aes(x = CreditScoreRangeUpper), data = loanData) +
  geom_histogram()
grid.arrange(creditUpper, creditLower, ncol = 1)
```
The shapes of the upper and lower credit scores histograms look roughly the 
same, so I would expect that the ranges are of a standard length of points. A
quick graph of the differences will confirm.

```{r echo=FALSE, "Differences of Upper and Lower Credit Scores"}
# differences of Upper and Lower Credit Scores

# looks like the range is only one length
ggplot(aes(x = (CreditScoreRangeUpper - CreditScoreRangeLower)),
       data = loanData) +
  geom_histogram()
# confirm the range is only one distance
with(loanData, table(CreditScoreRangeUpper - CreditScoreRangeLower))
```

Since the scores are of fixed length, any use of credit scores can use either
one to view any trends or make predictions.

* Prosper Score
```{r echo=FALSE, ProsperScore}
p1 <- ggplot(aes(x = ProsperScore), data = loanData) +
  geom_histogram() +
  scale_x_continuous(limits = c(0,12), breaks = seq(1,11,1))
# the cleaner plot hides that the scores are discrete
p2 <- ggplot(aes(x = ProsperScore), data = loanData) +
  geom_histogram(binwidth = 1, color = 'black', fill = 'blue') +
  scale_x_continuous(limits = c(0,12), breaks = seq(1,11,1))
grid.arrange(p1, p2, ncol = 1)
table(loanData$ProsperScore)
```

There seem to be only discrete Prosper scores and for some reason there are
score at 11, despite the range in the variable definition file indicating the
maximum is 10. Interestingly, the cleaner plot hides the descreteness of the 
variables.

* Borrower APR
```{r echo=FALSE, BorrowerAPR}
ggplot(aes(x = BorrowerAPR), data = loanData) +
  geom_histogram()
```

The peak for borrower rates is on par with credit card rates with a roughly
even distribution above and below. This variable will probably be good to use
as a predictor.

* Loan Amount
```{r echo=FALSE, LoanOriginalAmount}
ggplot(aes(x = LoanOriginalAmount), data = loanData) +
  geom_histogram(binwidth = 1000) +
  scale_x_continuous(limits = c(2000,40000), breaks = seq(2000,40000,2000)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

According to the Prosper website, the loans are from $2000 to $40000. Most of
the loans are of low value, but there are some clear spikes at higher numbers
at 5k intervals ($10000, $15000, $20000, $25000), which shows a bias for people
rounding off for their needs.

# Univariate Analysis

### What is the structure of your dataset?
There are 113937 entries, each containing 84 variables of different types.

All of the data categories are related to whether the loan would be a good
investment or not, which is presumably wrapped into their proprietary Prosper
score.

### What is/are the main feature(s) of interest in your dataset?
The main features of concern are going to be the variables that are commonly
primary contributors to risk, such as assets, liabilities, and current state of
leverage. Presumably these will be rolled up and reflected in the Prosper score
("ProsperScore"). The following are a listing of those variables:
"IncomeRange", "DebtToIncomeRatio", "DelinquenciesLast7Years", "TotalTrades",
"Term", "IsBorrowerHomeowner", "BankcardUtilization", "BorrowerAPR",
"LoanOriginalAmount", "CreditScoreRangeLower"/"CreditScoreRangeUpper"

### What other features in the dataset do you think will help support your \
investigation into your feature(s) of interest?
Additional features that might build a richer picture would include:
"ListingCategory..numeric." - to see what the loan is for
"LoanStatus" - to check on overdue loans
"Investors" - how many people have confidence that the borrower will pay?
"Recommentations" - how many people vouch for the borrower?
"EmploymentStatusDuration" - is the borrower's cashflow consistent?
"Occupation" - this might have an influence, but the categories are questionable

### Did you create any new variables from existing variables in the dataset?
I created IncomeRange2 and StatedMonthlyIncome.bucket:
* IncomeRange2 - consolidates "Not employed" to have an income of $0
* StatedMonthlyIncome.bucket - bucketed the StatedMonthlyIncome to test against
IncomeRange, but the results made it seem like the monthly income wasn't as
reliable.

### Of the features you investigated, were there any unusual distributions? \
Did you perform any operations on the data to tidy, adjust, or change the form \
of the data? If so, why did you do this?

All the data were skewed appropriately or of a normalized scoring. The
exceptions to a lot of distributions were around even number intervals, because
people round their expectation needs.

There were some strange things within some of the variables. The Prosper score
had scores of 11 even though the range was stated to be 1-10. There were
bankcard utilizations and debt-to-income ratios that were questionable, because
the borrower had much greater debt than they could pay, like the borrower that
had almost 600% bankcard utilization and the 799 borrowers that had more debt
payments per month than their monthly income.

# Bivariate Plots Section

> **Tip**: Based on what you saw in the univariate plots, what relationships
between variables might be interesting to look at in this section? Don't limit
yourself to relationships between a main output feature and one of the
supporting variables. Try to look at relationships between supporting variables
as well.

```{r echo=FALSE, Bivariate_Plots}

```

# Bivariate Analysis

> **Tip**: As before, summarize what you found in your bivariate explorations
here. Use the questions below to guide your discussion.

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

### What was the strongest relationship you found?


# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!

# References
[RStudio cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf)
[RStudio cheatsheet 2.0](https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf)
[StackOverflow: Rotating and spacing axis labels in ggplot2](https://stackoverflow.com/questions/1330989/rotating-and-spacing-axis-labels-in-ggplot2?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa)
[Debt to Income Ratio](https://www.consumerfinance.gov/ask-cfpb/what-is-a-debt-to-income-ratio-why-is-the-43-debt-to-income-ratio-important-en-1791/)
[Remove all of x axis labels in ggplot (duplicate)](https://stackoverflow.com/questions/35090883/remove-all-of-x-axis-labels-in-ggplot?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa)
[2 column Section in R Markdown](https://stackoverflow.com/questions/31753897/2-column-section-in-r-markdown?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa)
